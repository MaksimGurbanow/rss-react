import{n as r,r as l,y as R,v as d,x as P,p as j,w as S,z as N,A as I,O as z,B as w}from"./components-DYEYZaig.js";import{B as p,f as g,c as L}from"./formatAddress-DbCsjo9G.js";import{u as A,a as T,s as v,r as M,b as Q,c as B}from"./store-B4gwXQ22.js";const W=({placeholder:e,value:a,onChange:s,testid:t})=>{const n=o=>{s(o)};return r.jsx("input",{"data-testid":t,placeholder:e,className:"search-input",value:a,onChange:o=>n(o.target.value)})},$=({initial:e,end:a,callback:s,defaultToggled:t=!1,testid:n})=>{const[o,c]=l.useState(t);l.useEffect(()=>{c(t)},[t]);const h=()=>{c(u=>!u),s&&s()};return r.jsx("button",{className:"toggle-button",type:"button",onClick:h,"data-testid":n,children:r.jsx("div",{className:`toggle-circle ${o&&"toggled"}`,children:o?a.icon:e.icon})})};var E={exports:{}},D="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",U=D,F=U;function C(){}function k(){}k.resetWarningCache=C;var q=function(){function e(t,n,o,c,h,u){if(u!==F){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}e.isRequired=e;function a(){return e}var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:a,element:e,elementType:e,instanceOf:a,node:e,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:k,resetWarningCache:C};return s.PropTypes=s,s};E.exports=q();var H=E.exports;const i=R(H);var K=["color","size","title","className"];function f(){return f=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},f.apply(this,arguments)}function X(e,a){if(e==null)return{};var s=Y(e,a),t,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}function Y(e,a){if(e==null)return{};var s={},t=Object.keys(e),n,o;for(o=0;o<t.length;o++)n=t[o],!(a.indexOf(n)>=0)&&(s[n]=e[n]);return s}var y=l.forwardRef(function(e,a){var s=e.color,t=e.size,n=e.title,o=e.className,c=X(e,K);return d.createElement("svg",f({ref:a,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:t,height:t,fill:s,className:["bi","bi-brightness-high-fill",o].filter(Boolean).join(" ")},c),n?d.createElement("title",null,n):null,d.createElement("path",{d:"M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"}))});y.propTypes={color:i.string,size:i.oneOfType([i.string,i.number]),title:i.string,className:i.string};y.defaultProps={color:"currentColor",size:"1em",title:null,className:""};var G=["color","size","title","className"];function x(){return x=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},x.apply(this,arguments)}function J(e,a){if(e==null)return{};var s=V(e,a),t,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}function V(e,a){if(e==null)return{};var s={},t=Object.keys(e),n,o;for(o=0;o<t.length;o++)n=t[o],!(a.indexOf(n)>=0)&&(s[n]=e[n]);return s}var b=l.forwardRef(function(e,a){var s=e.color,t=e.size,n=e.title,o=e.className,c=J(e,G);return d.createElement("svg",x({ref:a,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:t,height:t,fill:s,className:["bi","bi-moon-stars-fill",o].filter(Boolean).join(" ")},c),n?d.createElement("title",null,n):null,d.createElement("path",{d:"M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"}),d.createElement("path",{d:"M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.73 1.73 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.73 1.73 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.73 1.73 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z"}))});b.propTypes={color:i.string,size:i.oneOfType([i.string,i.number]),title:i.string,className:i.string};b.defaultProps={color:"currentColor",size:"1em",title:null,className:""};const Z=({searchValue:e,onSearch:a})=>{const[s,t]=l.useState(e||""),{theme:n,toggleTheme:o}=A(),c=l.useMemo(()=>s!==e,[s,e]),h=P(),{pathname:u}=j();return l.useEffect(()=>{t(e||"")},[e]),r.jsxs("div",{className:"search-field","data-testid":"search-container",children:[r.jsx(W,{placeholder:"Type here to search what you need",value:s,onChange:m=>t(m),testid:"search-input"}),r.jsx(p,{testid:"search-button",disabled:!c,onClick:()=>{c&&a&&(a(s),h(g({query:s,pathname:u,newPage:1})))},children:"Search"}),r.jsx($,{initial:{icon:r.jsx(y,{})},end:{icon:r.jsx(b,{})},callback:o,defaultToggled:n==="dark",testid:"toggle-theme"})]})},ee=()=>{const[e,a]=l.useState("");return l.useEffect(()=>{const t=localStorage.getItem("searchQuery");t&&a(t)},[]),l.useEffect(()=>{e&&localStorage.setItem("searchQuery",e)},[e]),{searchQuery:e,update:t=>{a(t),localStorage.setItem("searchQuery",t)}}},te=({id:e})=>{const s=!!T(n=>n.savedProducts).find(n=>n.id===e),t=n=>{n.stopPropagation(),s?v.dispatch(M(e)):fetch(window.ENV.REMIX_API_PRODUCTS_URL+e).then(o=>o.json()).then(o=>v.dispatch(Q([o])))};return r.jsx("button",{onClick:t,"data-testid":`save-button-${e}`,className:"save-button",children:s?"Delete":"Save"})},ae=({title:e,images:a,id:s})=>{const{pathname:t,search:n}=j(),o=P();return r.jsxs("div",{className:"item","data-testid":"item-container",onClick:()=>{o(g({search:n,pathname:t,includeDetails:!0,newId:s}))},children:[r.jsx("h3",{className:"item-name","data-testid":"item-name",children:L(e)}),r.jsx("img",{loading:"lazy",role:"presentation",decoding:"async",alt:"Sprite",src:a[0],className:"item-image","data-testid":"item-image"}),r.jsx(te,{id:s})]})},se=()=>r.jsxs("div",{className:"no-items-message","data-testid":"no-items-container",children:[r.jsx("h3",{children:"Oops... No product found"}),r.jsx("h5",{children:"It seems that there is no such a product with given title"})]}),_=({items:e})=>r.jsx("div",{className:"items-list","data-testid":"list-container",children:e.length?e.map(a=>r.jsx(ae,{title:a.title,images:a.images,id:a.id},a.id)):r.jsx(se,{})}),ne=({total:e})=>{const{searchQuery:a="",page:s,limit:t=10}=S(),{pathname:n}=j();return r.jsxs("div",{className:"pagination",children:[r.jsx(p,{className:"pagination-pages__button previous",disabled:s<=1,testid:"pagination-previous",children:s>1?r.jsx(N,{to:g({query:a,pathname:n,newPage:s-1}),className:"pagination-link",children:"Previous"}):"Previous"}),s*t<e?r.jsx(N,{to:g({query:a,pathname:n,newPage:s+1}),className:"pagination-link",children:r.jsx(p,{className:"pagination-pages__button next",disabled:s*t>=e,testid:"pagination-next",children:"Next"})}):r.jsx(p,{className:"pagination-pages__button next",disabled:s*t>=e,testid:"pagination-next",children:"Next"})]})},O=()=>r.jsx("div",{className:"loader-container","data-testid":"loader-container",children:r.jsx("div",{className:"loader-block"})}),re=(e,a=1)=>{if(a<0)throw new Error("Quantity must be greater than 0");return a===1?e:e+"s"},oe=e=>{const a=["brand","description","price","title","rating","minimumOrderQuantity"],s=e.map(n=>a.map(o=>n[o]));let t=a.join(",")+`
`;return s.forEach(n=>{t+=n.map(o=>`"${o}"`).join(",")+`
`}),t},ie=()=>{const e=T(t=>t.savedProducts),a=()=>new Blob([oe(e)],{type:"text/csv;charset=utf-8,"}),s=async()=>{v.dispatch(B())};if(e.length)return r.jsxs("div",{className:"saved-products-block","data-testid":"saved-products",children:[r.jsx("h2",{className:"saved-products-header",children:"Saved items"}),r.jsxs("h3",{className:"saved-products-subheader",children:[e.length," ",re("item",e.length)," ","selected."]}),r.jsx(_,{items:e}),r.jsxs("div",{className:"saved-products-controllers",children:[r.jsx(p,{onClick:s,children:"Unselect all"}),r.jsx(p,{className:"saved-products-download",children:r.jsx("a",{className:"saved-products-download-link",href:URL.createObjectURL(a()),download:`${e.length}_products.csv`,children:"Download"})})]})]})},pe=()=>{const{searchQuery:e,update:a}=ee(),{res:s,page:t}=S(),n=I();return r.jsxs("div",{"data-testid":"main-page",children:[n.state==="loading"?r.jsx(O,{}):"",r.jsx(Z,{searchValue:e,onSearch:a}),r.jsx(z,{}),r.jsx(l.Suspense,{fallback:r.jsx(O,{}),children:r.jsx(w,{resolve:s,children:o=>r.jsx(_,{items:o.products})})}),r.jsx(w,{resolve:s,children:o=>r.jsx(ne,{total:o.total||0,page:t})}),r.jsx(ie,{})]})};export{pe as default};
